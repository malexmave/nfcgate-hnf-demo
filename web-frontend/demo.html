<!DOCTYPE html>
<!-- 
Copyright 2017, Max Maass

Licensed under the EUPL, Version 1.1 or - as soon they
will be approved by the European Commission - subsequent
versions of the EUPL (the "Licence");
You may not use this work except in compliance with the
Licence.
You may obtain a copy of the Licence at:

https://joinup.ec.europa.eu/software/page/eupl

Unless required by applicable law or agreed to in
writing, software distributed under the Licence is
distributed on an "AS IS" basis,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
express or implied.
See the Licence for the specific language governing
permissions and limitations under the Licence.
-->
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/jquery-ui.css">
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/custom-grid.css">
    </head>
    <body>
        <div class="container"  >

            <div class="row">
            	<div class="col-5">
            		<h1>Kontaktlos? <strong>Aber sicher!</strong></h1>
            		<p class="lead">Werden Sie selbst zum Sicherheitsforscher</p>
            	</div>
                <div class="col-5 text-center">
                    <div id="countdown" style="display: none;">
                        <p class="text-small">Exponat wird in</p>
                        <p class="text-large" id="countdown-seconds">30</p>
                        <p class="text-small">Sekunden zurückgesetzt</p>
                    </div>
                </div>
            	<div class="col-2 text-right">
            		<div id="carouselExampleSlidesOnly" class="carousel slide carousel-right" style="float: right;" data-ride="carousel">
					  <div class="carousel-inner" role="listbox">
					    <div class="carousel-item active">
					      <img class="d-block img-fluid" src="img/cysec3.png" alt="First slide">
					    </div>
					    <div class="carousel-item">
					      <img class="d-block img-fluid" src="img/crisp3.png" alt="Second slide">
					    </div>
					    <div class="carousel-item">
					      <img class="d-block img-fluid" src="img/seemoo3.png" alt="Third slide">
					    </div>
                        <div class="carousel-item">
                          <img class="d-block img-fluid" src="img/tud3.png" alt="Fourth slide">
                        </div>
					  </div>
					</div>
            	</div>
            </div>

            <!-- <section class="jumbotron text-center"> 
            	<div class="container">
            	    <h1 class="jumbotron-heading">Tür ist verschlossen</h1>
            	    <p class="lead text-muted">Bitte halten Sie Ihre Karte an den Leser</p>
            	</div>
            </section> -->

            <!-- Slide 1 - Introduction -->
            <div class="row content-row absolute" id="page-1">
                 <div class="col-6">
                    <h3>Kontaktlose Karten</h3>
                    <p>Kontaktlose Funktechnologien werden in vielen Anwendungen eingesetzt. Eine dieser Technologien ist NFC (Near Field Communication).</p>
                    <p>Mit dem elektronischen Personalausweis und Reisepass können Sie sich im Internet ausweisen. Bei NFC-Schließsystemen können Sie Türen mit einer Schlüsselkarte öffnen. Mit vielen EC- und Kreditkarten kann man mittlerweile in Geschäften kontaktlos bezahlen.</p>

                    <!-- <div class="panel panel-default stretch">
                      <div class="panel-heading">
                        <h3 class="panel-title">Wie funktioniert das?</h3>
                      </div>
                      <div class="panel-body">
                        Das Lesegerät baut ein elektromagnetisches Feld auf, welches durch die Antennen in der Karte aufgefangen und in Strom umgewandelt wird. Dieser Strom versorgt einen kleinen Chip, der wiederum seine Nachrichten über das selbe Feld an den Leser übertragen kann.
                      </div>
                    </div> -->
                    <div class="panel panel-instruction stretch">
                        <div class="panel-body">
                            <h3 >Probieren Sie es aus:</h3>
                            <strong>Halten Sie die NFC-Schlüsselkarte an das Schloss auf dem Lesegerät</strong>, um die Tür zu öffnen. Finden Sie so heraus, welche Sicherheitsprobleme diese Technik haben kann.
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="row">
                        <!-- <div class="col-6" style="background-color: red; height: 100%;" id="indicator-1"> </div> -->
                        <div class="col-6 scard moving-scard" style="margin: 0px !important; padding:0px !important;" id="scard-1"></div>
                        <div class="col-6 door" id="door-1"> </div>
                        <!--<div style="position: absolute; top: 100px; left: 75px; color: red; font-family: monospace;"><strong>Karte nicht autorisiert</strong></div>-->
                    </div>

                </div>
            </div> <!-- End row -->


            <!-- Slide 2 - Clone -->
            <div class="row content-row absolute" style="display: none;" id="page-2">
                <div class="col-6">
                    <h3>Sicherheit von kontaktloser Kommunikation</h3>
                    <p>Die Sicherheit von NFC-Systemen hängt davon ab, wie sie die Identität der Karte prüfen.</p>
                    <p>Sichere Systeme benutzen Kryptographie, um sicherzustellen, dass die Karte berechtigt ist, die Tür zu öffnen.</p>
                    <p>Leider bauen manche Hersteller unsichere Systeme, die sich leicht überlisten lassen.</p>

                    <div class="panel panel-instruction stretch">
                        <div class="panel-body">
                            <h3>Probieren Sie es aus:</h3>
                            <p>Kopieren Sie die NFC-Schlüsselkarte, indem Sie sie an die Rückseite des Smartphones halten. Achten Sie dabei auf den Bildschirm des Smartphones.</p>
                            Berühren Sie anschließend mit der Rückseite des Smartphones das Schloss auf dem Lesegerät und sehen Sie, was passiert.
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="row">
                        <div class="col-6 phone moving-phone" id="phone-2"> </div>
                        <div class="col-6 door" id="door-2"> </div>
                    </div>

                </div>
            </div> <!-- End row -->

            <!-- Slide 3 - WTF just happened? -->
            <div class="row content-row absolute" style="display: none;" id="page-3">
                <div class="col-6">
                    <h3>Was ist gerade passiert?</h3>
                    <p>Dieses Schließsystem ist unsicher, denn es prüft nur ein einziges Sicherheitsmerkmal: die Seriennummer der Schlüsselkarte. Jede NFC-Karte besitzt zwar eine einzigartige Seriennummer, diese kann aber leicht ausgelesen und kopiert werden.</p>
                    <p>Damit haben Sie das Schließsystem überlistet. Die Tür konnte mit der kopierten Information auf dem Smartphone geöffnet werden, statt mit der zugehörigen Schlüsselkarte. Ein Dieb könnte zum Beispiel im Gedränge Ihre NFC-Schlüsselkarte aus dem Geldbeutel in der Hosentasche auslesen und damit Ihr Büro aufschließen.</p>

                    <div class="panel panel-instruction stretch">
                        <div class="panel-body">
                            <h3>Wie können Sie sich schützen?</h3>
                            Halten Sie die NFC-Schlüsselkarte noch einmal an das Schloss auf dem Lesegerät.
                        </div>
                    </div>
                    <!-- <div class="card card-sidenote mb-3 stretch">
                      <div class="card-block"> -->
                        <h3 style="color: #686868;">Ist das nicht gefährlich?</h3>
                        <span style="font-size: 1.4rem !important; color: #686868;">In den falschen Händen könnte unser System auch von Kriminellen eingesetzt werden. Gleichzeitig können wir damit Sicherheitsprobleme in Systemen finden, bevor es andere tun. Dadurch tragen wir zur Verbesserung der Sicherheit dieser Systeme bei. Es handelt sich also um eine <i>dual use</i>-Technologie, die sowohl helfen als auch schaden kann - dies ist in der IT-Sicherheitsforschung oft der Fall.</span>
                      <!-- </div>
                    </div> -->

                </div>
                <div class="col-6">
                    <div class="row">
                        <div class="col-6 scard moving-scard" id="scard-3"> </div>
                        <div class="col-6 door" id="door-3"> </div>
                    </div>

                </div>
            </div> <!-- End row -->

            <!-- Slide 4 - Schutzmaßnahmen -->
            <div class="row content-row absolute" style="display: none;" id="page-4">
                <div class="col-12">
                    <h3>Welche Schutzmaßnahmen gibt es?</h3>
                    <div class="row">
                        <div class='col-6'>
                            <p>Als <strong>Privatperson</strong> können Sie Ihre NFC-Karten schützen, indem Sie sie in speziellen Hüllen transportieren. Diese Kartenhüllen blockieren Funkverbindungen, da das Material ein sehr feines Netz von Metalldrähten enthält.</p>

                            <p>Dieser Effekt lässt sich auch mit einem einfachen Hausmittel erzeugen: Legen Sie ein passend zugeschnittenes Stück <strong>Aluminiumfolie</strong> in das Scheinfach Ihres Geldbeutels. Solange alle Karten von der Aluminiumfolie bedeckt sind, können sie nicht ausgelesen werden.</p>
                            <img src="img/nfc-wallet.png" width="400px" />
                            <img src="img/nfc-sleeve.png" width="400px"/>
                        </div>
                        <div class="col-6">
                            <p>Die <strong>Hersteller</strong> von NFC-Systemen sollten sicherstellen, dass ihre Geräte die Berechtigung der Karte genau prüfen. Wie unser Experiment gezeigt hat, reicht die Seriennummer als einziges Sicherheitsmerkmal nicht aus. Stattdessen sollte das System die Identität der NFC-Karte mit kryptographischen Methoden, wie zum Beispiel elektronischen Signaturen, prüfen.</p>

                            <!--<p>Ein weiteres Sicherheitsmerkmal ist das distance-bounding-Protokoll: Damit kann das System prüfen, dass die Karte sich tatsächlich in der Nähe des Lesegeräts befindet.</p> -->
                            <p>Um andere Angriffe zu verhindern, sollten Hersteller außerdem ein <i>distance-bounding</i>-Protokoll einsetzen. Damit prüft das System, dass die Karte sich tatsächlich in der Nähe des Lesegeräts befindet.</p>
                            <center>
                            <!--<img src="img/nfc-signature.png" width="400px" /> -->
                            <img src="img/nfc-distance-bounding.png"  width="400px"/>
                            </center>
                        </div>
                    </div>
                </div>
            </div> <!-- End row -->

        </div> <!-- /container -->
        
        <footer class="blog-footer">
            <!-- <div style="position: relative; top: -10px;">
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                    
                </div>
            </div> -->
            <div class="row nopad">
                <div class="col-4 text-left nopad">
                    <span id="log"></span>
                </div>
                <div class="col-4 nopad text-center">
                    <span class="circle circle-active" id="page-indicator-1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <span class="circle" id="page-indicator-2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <span class="circle" id="page-indicator-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <span class="circle" id="page-indicator-4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                </div>
                <div class="col-4 nopad">
                    <p> Mehr Informationen unter <a href="http://seemoo.de/nfcgate"><strong>seemoo.de/nfcgate</strong></a></p>
                </div>
            </div>
        </footer>





        <!-- jQuery first, then Tether, then Bootstrap JS. -->
        <script src="js/jquery-3.1.1.min.js"></script>
        <script src="js/tether.min.js"></script>
        <script src="js/bootstrap.min.js" ></script>
        <script src="js/jquery-ui.js"></script>

        <script type="text/javascript">
            document.body.style.cursor = 'none';
            var sock = null;
            var ellog = null;
            window.onload = function() {
                var wsuri;
                ellog = document.getElementById('log');

                if (window.location.protocol === "file:") {
                   wsuri = "ws://localhost:9000";
                } else {
                   wsuri = "ws://" + window.location.hostname + ":9000";
                }

                if ("WebSocket" in window) {
                   sock = new WebSocket(wsuri);
                } else if ("MozWebSocket" in window) {
                   sock = new MozWebSocket(wsuri);
                } else {
                   log("Browser does not support WebSocket!");
                }

                if (sock) {
                   sock.onopen = function() {
                      //log("Connected to " + wsuri);
                      log("");
                   }
                   sock.onclose = function(e) {
                      //log("Connection closed (wasClean = " + e.wasClean + ", code = " + e.code + ", reason = '" + e.reason + "')");
                      log("<strong style='color:red'>Verbindung zum Backend nicht möglich. Versuche erneut...</strong>");
                      setTimeout(window.onload, 1000);
                      sock = null;
                   }

                   sock.onmessage = function(e) {
                      if (e.data == "04787312144e80") {
                        orchestrator.advance();
                      } else if (e.data == "046c6512144e80") {
                        orchestrator.advance();
                      }
                   }
                }
            };

            function broadcast() {
                var msg = document.getElementById('message').value;

                if (sock) {
                   sock.send(msg);
                   log("Sent: " + msg);
                } else {
                   log("Not connected.");
                }

            };

            function slide_switch(div1, div2, callback) {
                $(div1).hide("slide", { direction: "left" }, 1000);
                            setTimeout(function() {$(div2).show("slide", { direction: "right" }, 1000, callback)}, 100);
            };
            var orchestrator = (function() {
                var INTERMEDIATE_TIME_WARN  = 40000; // 40 seconds
                var INTERMEDIATE_TIME_RESET = 20000; // another 20 seconds during which a warning is displayed
                var FINAL_TIME_WARN         = 60000; // 60 seconds
                var FINAL_TIME_RESET        = 20000; // 20 seconds

                var current = 1;
                var timer = 0;
                var interval = 0;

                var timeRemaining = 0;

                var pub = {};

                pub.warn_timer = function(time_warn, time_reset, currentDiv) {
                    timer = setTimeout(function() {
                        $('#countdown').fadeIn(1000);
                        timeRemaining = time_reset;
                        $('#countdown-seconds').text(timeRemaining / 1000);
                        interval = setInterval(function() {
                            timeRemaining = timeRemaining - 1000;
                            $('#countdown-seconds').text(timeRemaining / 1000);
                            if (timeRemaining <= 0) {
                                clearInterval(interval);
                                $('#countdown').fadeOut(1000);
                            }
                        }, 1000);
                        timer = setTimeout(function() {
                            $(currentDiv).hide("slide", { direction: "right" }, 1000);
                            setTimeout(function() {$('#page-1').show("slide", { direction: "left" }, 1000)}, 100);
                            pub.switch_off(current);
                            pub.switch_on(1);
                            current = 1;
                        }, time_reset);
                    }, time_warn);
                };

                pub.clear_timer = function() {
                    clearTimeout(timer);
                    clearInterval(interval);
                    $('#countdown').fadeOut();
                };

                pub.switch_on = function(no) {
                    $('#page-indicator-' + no).animate({backgroundColor: '#808080'}, 500); // Grey
                };

                pub.switch_off = function(no) {
                    $('#page-indicator-' + no).animate({backgroundColor: '#ffffff'}, 500); // White
                };

                pub.advance = function() {
                    //$('#indicator').css('background-color', 'green');
                    if (current == 1) {
                        // Play door opening animation
                        $('#door-1').addClass('opening-door');
                        $('#scard-1').removeClass('moving-scard').addClass('scanned-scard');
                        // Also change indicator color
                        setTimeout(function() {
                            // Door opening animation finished, remove class
                            $('#door-1').removeClass('opening-door');
                            // Instead set the door to open
                            $('#door-1').addClass('open-door');
                            // Slide over from page 1 to 2
                            slide_switch('#page-1', '#page-2', function() {
                                // Reset background color and door status
                                $('#scard-1').removeClass('scanned-scard').addClass('moving-scard');
                                $('#door-1').removeClass('open-door');
                            });
                            // Update breadcrumbs
                            pub.switch_off(1);
                            pub.switch_on(2);
                            // Update warn timer
                            pub.warn_timer(INTERMEDIATE_TIME_WARN, INTERMEDIATE_TIME_RESET, '#page-2');
                        }, 1500);
                        current = 2;
                    } else if (current == 2) {
                        pub.clear_timer();
                        $('#door-2').addClass('opening-door');
                        $('#phone-2').removeClass('moving-phone').addClass('scanned-phone');
                        setTimeout(function() {
                            // Door opening animation finished, remove class
                            $('#door-2').removeClass('opening-door');
                            // Instead set the door to open
                            $('#door-2').addClass('open-door');
                            slide_switch('#page-2', '#page-3', function() {
                                $('#phone-2').removeClass('scanned-phone').addClass('moving-phone');
                                $('#door-2').removeClass('open-door');
                            });
                            pub.switch_off(2);
                            pub.switch_on(3);
                            pub.warn_timer(INTERMEDIATE_TIME_WARN, INTERMEDIATE_TIME_RESET, '#page-3');
                        }, 1500);
                        current = 3;
                    } else if (current == 3) {
                        pub.clear_timer();
                        $('#door-3').addClass('opening-door');
                        $('#scard-3').removeClass('moving-scard').addClass('scanned-scard');
                        setTimeout(function() {
                            // Door opening animation finished, remove class
                            $('#door-3').removeClass('opening-door');
                            // Instead set the door to open
                            $('#door-3').addClass('open-door');
                            slide_switch('#page-3', '#page-4', function() {
                                $('#scard-3').removeClass('scanned-scard').addClass('moving-scard');
                                $('#door-3').removeClass('open-door');
                            });
                            pub.switch_off(3);
                            pub.switch_on(4);
                            pub.warn_timer(FINAL_TIME_WARN, FINAL_TIME_RESET, '#page-4');
                        }, 1500);
                        current = 4;
                    } else if (current == 4) {
                        pub.clear_timer();
                        $('#page-4').hide("slide", { direction: "right" }, 1000);
                        setTimeout(function() {$('#page-1').show("slide", { direction: "left" }, 1000)}, 100);
                        pub.switch_off(4);
                        pub.switch_on(1);
                        current = 1;
                    }
                };

                return pub;
            }());
            

            function log(m) {
                ellog.innerHTML = m;
                ellog.scrollTop = ellog.scrollHeight;
            };
        </script>
    </body>
</html>
